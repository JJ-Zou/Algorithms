
#### 进程和线程的区别

- 进程是资源分配的基本单位，线程是CPU调度的基本单元
- 进程拥有独立的地址空间，一个进程内可以有多个线程，这些线程共享进程的地址空间
- 创建或撤销进程的开销远大于线程，在进行进程切换时，需要保存当前进程上下文，恢复调度进程的上下文（CPU寄存器中的数据），线程切换时只需要保存线程私有的数据栈、寄存器、程序计数器
- 进程间交换数据需要通过进程间通信，线程可以通过共享数据进行通信

#### 进程调度算法

- 先来先服务：非抢占式，FIFO
- 短作业优先：按照估计的运行时间调度最短运行时间的任务
- 最短剩余时间优先：可抢占式的短作业优先
- 优先级调度：为进程分配优先级，按优先级进行调度
- 时间片轮转：按FIFO队列，分配CPU时间片
- 多级反馈队列：拥有多个独立队列，每个队列有不同的优先级，按时间片轮转的方式优先执行高优先级队列中的作业，作业刚来时进入最高优先级，时间片轮转后降低其优先级，一段时间后将所有作业重新加入最高优先级队列

#### 进程间通信

1、管道

管道是半双工的，只能在父子进程或兄弟进程中使用。可以由父进程创建，进程fork子进程后使用。

2、FIFO命名管道

命名管道可以在不相关的进程间使用，通过创建fifo文件进行数据交换。

3、消息队列

消息队列存储在内核，进程可从中读写数据，可以独立于读写进程存在，一个进程可以在写入数据后退出，另外一个进程仍然可以打开并读取数据，避免了命名管道的同步阻塞，接收程序可以有选择地接收数据。

4、信号量

是一个计数器，用于协调多个进程对共享数据的访问，提供不同进程访问共享数据的同步手段。

5、共享内存

允许多个进程共享一个给定的存储区域，因为数据不需要在进程间复制，速度非常快，但是需要额外的同步手段来保证共享资源的同步访问。

6、Socket

可以用于不同计算机之间的IPC通信。

#### 孤儿进程

父进程退出，而他的子进程还在运行，子进程成为孤儿进程，将被init进程（1号）收养。

#### 僵尸进程

子进程的进程描述符只有在父进程通过wait或waitpid获取子进程信息后才会释放，如果子进程退出，而父进程没有调用wait或waitpid，那么子进程的描述符仍然保存在系统中，成为僵尸进程。

僵尸进程在ps下表示为Z。系统能够使用的进程号是有限的，如果产生大量僵尸进程，将无法分配进程号。可以通过杀死父进程来解决僵尸进程，此时僵尸进程变为孤儿进程从而被init进程收养。

#### 死锁

死锁的必要条件，互斥、请求和保持、不可剥夺、环路等待。
- 大多数情况下死锁发生的概率很低，可以忽略。
- 通过对加锁设置超时时间预防死锁
- 对资源统一编号，进程必须按顺序请求资源

#### 虚拟内存

进程启动时，操作系统会提供一个连续的独立地址空间，进程可以进行内存访问，这里的内存就是虚拟内存。虚拟内存是为了，方便进程进行内存管理，让有限的物理内存可以运行更大的程序。

每个程序拥有自己的地址空间，这个空间被分割成页（大小为4K）页的地址都是连续的，映射到物理内存中，物理内存的地址不要求连续，通常按需分配页映射到物理内存。

内存管理单元(MMU)管理地址空间和物理内存的转换，页表存储页（程序地址空间）和页框（物理内存空间）的映射表。虚拟地址一部分存储页面号，一部分存储偏移量，用于索引。

#### 页面置换

当访问的页面页面不在内存中时，会引发缺页异常陷入中断，内核会分配物理内存，返回对应的物理地址更新页表。如果此时内存已满，操作系统必须将其中一个页面换出。

- 最佳页面置换算法：理论上被换出的页将是最长时间不再被访问
- 最近最少使用(LRU)：根据过往使用情况，通过一个链表，当一个页面被访问时，将这个页面移到链表的头部，这样就能保证链表尾部是最近最少使用。
- 最近未使用：通过两个状态位R(读)、M(修改)，其中R定时清零，分为00、01、10、11，发生缺页中断时，会随机从编号最小的中挑出一个换出。
- 先进先出(FIFO)
- 第二次机会：对FIFO的修改，通过链表和一个状态为R，当页面被访问时R至1，需要替换时，检查R是否为1（最近访问），如果为0立刻置换掉，否则放入链表尾部并清0，继续从链表头部开始搜索。
- 时钟：使用环形链表，不再移动链表结点，而是用指针指向最老的页面，然后移动指针。

#### 进程相关Linux命令

```shell script
top:实时显示进程状态
top -p [pid]:查看固定进程的资源使用情况

ps:显示当前进程状态
ps -A:列出所有进程
ps -aux:显示所有用户的进程
ps -ef | grep [word]:查找指定进程
ps -o majflt,minflt -p [pid]:查看缺页中断次数
cat /proc/[pid]/status:查看更详细的进程信息

ipcs:显示进程间通信信息，消息队列、共享内存和信号量

pstree:显示进程树

lsof:列出进程打开或使用的文件信息
lsof -p [pid]:列出进程打开的文件
lsof -i:[port]:根据端口查看

netstat -a:列出所有连接
netstat -t:列出TCP连接
netstat -u:列出UDP连接
netstat -l:列出正在监听的Socket
netstat -n:禁用反向域名解析
netstat -p:查看进程信息
netstat -e:查看用户和Inode
netstat -c:持续输出

tcpdump:抓包工具
```

